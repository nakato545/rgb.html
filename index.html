<index html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ—ãƒ­ã‚°ãƒ©ãƒ é¸æŠãƒšãƒ¼ã‚¸</title>
<style>
body { font-family:sans-serif; text-align:center; background:#f7f7f7; }
button { font-size:20px; margin:20px; padding:10px 20px; }
iframe { width: 95%; height: 90vh; border:1px solid #ccc; display:none; margin-top:20px; }
</style>
</head>
<body>

<h1>ãƒ—ãƒ­ã‚°ãƒ©ãƒ é¸æŠãƒšãƒ¼ã‚¸</h1>
<p>ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’è¡¨ç¤ºã—ã¾ã™</p>

<button onclick="showProgram('soccer')">âš½ ã‚µãƒƒã‚«ãƒ¼äºŒæ¬¡é–¢æ•°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
<button onclick="showProgram('antenna')">ğŸ“¡ æ”¾ç‰©ç·šã‚¢ãƒ³ãƒ†ãƒŠã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
<button onclick="showProgram('montecarlo')">ğŸ”´ ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•ã§Ï€ã‚’æ±‚ã‚ã‚‹</button>

<iframe id="progFrame"></iframe>

<script>
function showProgram(name){
    const iframe = document.getElementById('progFrame');
    iframe.style.display = 'block';
    if(name==='soccer'){
        iframe.srcdoc = `<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚µãƒƒã‚«ãƒ¼äºŒæ¬¡é–¢æ•°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
<style>
body { font-family:sans-serif; text-align:center; background:#f7f7f7; }
canvas { background:#fff; border:1px solid #bbb; }
.controls { margin-top:10px; }
button,input[type=range] { margin:5px; }
#formula { position:absolute; background:rgba(255,255,255,0.8); padding:4px; font-weight:bold; bottom:40px; left:60px; }
#bigmsg { position:absolute; left:50%; top:45%; transform:translate(-50%,-50%); font-size:48px; font-weight:bold; color:#0a6; display:none; }
</style>
</head>
<body>

<h2>âš½ ã‚µãƒƒã‚«ãƒ¼ã¨äºŒæ¬¡é–¢æ•°</h2>
<div style="position:relative; display:inline-block;">
<canvas id="cv" width="900" height="600"></canvas>
<div id="formula"></div>
<div id="bigmsg"></div>
</div>

<div class="controls">
<label>ç›®æ¨™ X:<input id="mx" type="range" min="10.1" max="10.9" step="0.01" value="10.5"></label><br>
<label>ç›®æ¨™ Y:<input id="my" type="range" min="0.1" max="9.9" step="0.1" value="5"></label><br>
<button id="startBtn" style="font-size:20px; background:#ff8;">ã‚·ãƒ¥ãƒ¼ãƒˆ</button>
<button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
<label><input id="axisToggle" type="checkbox" checked> åº§æ¨™è»¸è¡¨ç¤º</label>
<button id="showè§£èª¬">è§£èª¬</button>
</div>

<div id="è§£èª¬" style="display:none; max-width:800px; margin:auto; text-align:left; background:#f9f9f9; border:1px solid #ccc; padding:10px; border-radius:8px; margin-top:10px;">
<h3>ã‚µãƒƒã‚«ãƒ¼ã¨äºŒæ¬¡é–¢æ•°ã®è§£èª¬</h3>
<p>âš½ ã‚µãƒƒã‚«ãƒ¼ã®ã‚·ãƒ¥ãƒ¼ãƒˆã¯ã€ãƒœãƒ¼ãƒ«ãŒæ”¾ç‰©ç·šã‚’æãé‹å‹•ã®ä»£è¡¨ä¾‹ã§ã™ã€‚</p>
<ul>
<li>æ”¾ç‰©ç·šã®ä¸€ç•ªé«˜ã„ç‚¹ã‚’ <span style="color:red;">é ‚ç‚¹</span> ã¨å‘¼ã³ã¾ã™ã€‚</li>
<li>å¹³æ–¹å®Œæˆã‚’ã™ã‚‹ã¨é ‚ç‚¹ã®åº§æ¨™ãŒæ±‚ã‚ã‚„ã™ããªã‚Šã¾ã™ã€‚</li>
</ul>
<p style="text-align:center; font-weight:bold;">
y = -0.6 (x - b/1.2)<sup>2</sup> + b<sup>2</sup>/1.2
</p>
<p>ã‚´ãƒ¼ãƒ«ï¼ˆç›®æ¨™ç‚¹ï¼‰ã‚’æ±ºã‚ã‚‹ã¨æ”¾ç‰©ç·šã¯ä¸€æ„ã«å®šã¾ã‚Šã¾ã™ã€‚</p>
<p>æ”¾ç‰©ç·šã®é ‚ç‚¹ã¯ãƒœãƒ¼ãƒ«ã®æœ€é«˜åˆ°é”ç‚¹ã§ã‚ã‚Šã€ã‚´ãƒ¼ãƒ«ã‚’é€šã‚‹ã‹ã©ã†ã‹ã‚’æ±ºã‚ã‚‹é‡è¦ãªè¦ç´ ã§ã™ã€‚</p>
<div style="border:1px solid #444; border-radius:10px; padding:10px; margin-top:10px; background:#f9f9f9;">
<h4>ğŸ’¡ ä»–ã®èº«è¿‘ãªæ”¾ç‰©ç·š</h4>
<ul>
<li>å™´æ°´ã®æ°´ã®è»Œé“</li>
<li>é‡çƒã®ãƒ•ãƒ©ã‚¤</li>
<li>ãƒã‚¹ã‚±ãƒƒãƒˆãƒœãƒ¼ãƒ«ã®ã‚·ãƒ¥ãƒ¼ãƒˆ</li>
</ul>
</div>
</div>

<script>
const canvas = document.getElementById('cv');
const ctx = canvas.getContext('2d');
const a = -0.6;
let Mx = parseFloat(document.getElementById('mx').value);
let My = parseFloat(document.getElementById('my').value);
let b=0, xv=0, yv=0;
let path = [], animing=false, animX=0, trail=[];
let dxPerFrame = 0.05;
const scaleX = (canvas.width-120)/15;
const scaleY = (canvas.height-120)/30;
const margin=60;
let showAxes = document.getElementById('axisToggle').checked;
const formulaBox = document.getElementById('formula');
const bigmsg = document.getElementById('bigmsg');

function computeB(){return (My + Math.abs(a)*Mx*Mx)/Mx;}
function parab(x){return a*x*x + b*x;}
function computeVertex(){xv=-b/(2*a); yv=parab(xv);}
function computePath(){ path=[]; for(let x=0;x<=15;x+=0.02){path.push({x,y:parab(x)});} }
function toCanvasX(x){return margin + x*scaleX;}
function toCanvasY(y){return canvas.height - margin - y*scaleY;}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(showAxes){
        ctx.strokeStyle="#ddd"; ctx.lineWidth=1;
        for(let x=0;x<=15;x++){ctx.beginPath(); ctx.moveTo(toCanvasX(x), margin/2); ctx.lineTo(toCanvasX(x), canvas.height-margin/2); ctx.stroke();}
        for(let y=0;y<=30;y++){ctx.beginPath(); ctx.moveTo(margin/2, toCanvasY(y)); ctx.lineTo(canvas.width-margin/2, toCanvasY(y)); ctx.stroke();}
        ctx.fillStyle="#333"; ctx.font="12px sans-serif";
        for(let x=0;x<=15;x++){ctx.fillText(x, toCanvasX(x)-6, canvas.height-margin+14);}
        for(let y=0;y<=30;y++){ctx.fillText(y, 6, toCanvasY(y)+4);}
    }

    ctx.beginPath();
    for(let i=0;i<path.length;i++){
        let p=path[i];
        if(i==0) ctx.moveTo(toCanvasX(p.x), toCanvasY(p.y));
        else ctx.lineTo(toCanvasX(p.x), toCanvasY(p.y));
    }
    ctx.setLineDash([6,6]);
    ctx.strokeStyle="#4b6fbf"; ctx.lineWidth=2; ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle="#000"; ctx.beginPath(); ctx.arc(toCanvasX(0), toCanvasY(0), 6,0,Math.PI*2); ctx.fill();
    ctx.fillText(`é¸æ‰‹ (0,0)`, toCanvasX(0)+10, toCanvasY(0)-8);

    ctx.fillStyle="#d9534f"; ctx.beginPath(); ctx.arc(toCanvasX(Mx), toCanvasY(My),11,0,Math.PI*2); ctx.fill();
    ctx.fillStyle="#700"; ctx.fillText(`ã‚´ãƒ¼ãƒ« (${Mx.toFixed(2)},${My.toFixed(1)})`, toCanvasX(Mx)-40, toCanvasY(My)-16);

    ctx.fillStyle="#0a8"; ctx.beginPath(); ctx.arc(toCanvasX(xv), toCanvasY(yv),6,0,Math.PI*2); ctx.fill();
    ctx.fillStyle="#067"; ctx.fillText(`é ‚ç‚¹ (${xv.toFixed(2)},${yv.toFixed(2)})`, toCanvasX(xv)+10, toCanvasY(yv)-8);

    ctx.strokeStyle="#000"; ctx.lineWidth=3;
    ctx.beginPath(); ctx.moveTo(toCanvasX(11), toCanvasY(0)); ctx.lineTo(toCanvasX(11), toCanvasY(10)); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(toCanvasX(10), toCanvasY(10)); ctx.lineTo(toCanvasX(11), toCanvasY(10)); ctx.stroke();

    if(trail.length>0){
        ctx.beginPath();
        for(let i=0;i<trail.length;i++){
            let p=trail[i];
            if(i==0) ctx.moveTo(toCanvasX(p.x), toCanvasY(p.y));
            else ctx.lineTo(toCanvasX(p.x), toCanvasY(p.y));
        }
        ctx.strokeStyle="#ff8c00"; ctx.lineWidth=3; ctx.stroke();
    }

    if(animing){
        ctx.fillStyle="#ff6600"; ctx.beginPath();
        ctx.arc(toCanvasX(animX), toCanvasY(parab(animX)),9,0,Math.PI*2); ctx.fill();
    }

    formulaBox.innerHTML = `y = ${a.toFixed(2)}(x - ${xv.toFixed(2)})Â² + ${yv.toFixed(2)}`;
}

function checkGoal(x,y){ return Math.hypot(x-Mx,y-My)<0.7; }
function checkLineCollision(x,y){ return (x>=10 && x<=11 && Math.abs(y-10)<0.2) || (Math.abs(x-11)<0.2 && y>=0 && y<=10); }

function animateStep(){
    if(!animing) return;
    animX += dxPerFrame;
    let y=parab(animX);
    trail.push({x:animX,y:y});
    if(animX>15.001 || y<-1){
        animing=false; showMessage("å¤±æ•—","#d33"); draw(); return;
    }
    if(checkGoal(animX,y)){
        animing=false; showMessage("ã‚´ãƒ¼ãƒ«ï¼","#0a6"); draw(); return;
    }
    if(checkLineCollision(animX,y)){
        animing=false; showMessage("ãƒãƒ¼ã«å½“ãŸã£ãŸï¼","#d33"); draw(); return;
    }
    draw();
    requestAnimationFrame(animateStep);
}

function recomputeAll(){
    Mx=parseFloat(document.getElementById('mx').value);
    My=parseFloat(document.getElementById('my').value);
    b=computeB();
    computeVertex();
    computePath();
    animing=false; animX=0; trail=[]; hideMessage(); draw();
}

function startShoot(){
    recomputeAll();
    animX=0; trail=[]; animing=true;
    requestAnimationFrame(animateStep);
}

function showMessage(txt,col){ bigmsg.style.display='block'; bigmsg.style.color=col; bigmsg.textContent=txt; }
function hideMessage(){ bigmsg.style.display='none'; }

function resetAll(){
    animing=false; animX=0; trail=[]; hideMessage();
    Mx=10.5; My=5;
    document.getElementById('mx').value=Mx;
    document.getElementById('my').value=My;
    recomputeAll();
}

function toggleè§£èª¬(){ 
    const elem=document.getElementById('è§£èª¬');
    elem.style.display = (elem.style.display==="none")?"block":"none";
}

document.getElementById('mx').addEventListener('input', recomputeAll);
document.getElementById('my').addEventListener('input', recomputeAll);
document.getElementById('startBtn').addEventListener('click', startShoot);
document.getElementById('resetBtn').addEventListener('click', resetAll);
document.getElementById('axisToggle').addEventListener('change', ()=>{ showAxes=document.getElementById('axisToggle').checked; draw(); });
document.getElementById('showè§£èª¬').addEventListener('click', toggleè§£èª¬);
recomputeAll();
</script>

</body>
</html>`;
    } else if(name==='antenna'){
        iframe.srcdoc = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>æ”¾ç‰©ç·šã‚¢ãƒ³ãƒ†ãƒŠã¨å…‰ç·šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‹è§£èª¬</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.4.2/lib/p5.js"></script>
<style>
body { text-align: center; font-family: sans-serif; }
canvas { border: 1px solid black; background: #f0f0f0; display:block; margin: 0 auto; }
#controls { margin-top: 10px; }
label { margin-right: 10px; }
button { margin-left: 5px; margin-right:5px; }
</style>
</head>
<body>
<h2>æ”¾ç‰©ç·šã‚¢ãƒ³ãƒ†ãƒŠã¨å…‰ç·šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‹è§£èª¬</h2>
<div id="controls">
  <button id="simButton">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º</button>
  <button id="explainButton">è§£èª¬è¡¨ç¤º</button>
  <span id="simControls" style="display:inline-block;">
    <label for="xSlider">xåº§æ¨™:</label>
    <input type="range" id="xSlider" min="-100" max="100" value="0" step="1" style="width:300px;">
    <span id="xValue">0</span>
    <button id="dropButton">ç™ºå°„</button>
    <button id="superButton">ã‚¹ãƒ¼ãƒ‘ãƒ¼ç™ºå°„</button>
    <button id="toggleFocus">ç„¦ç‚¹è¡¨ç¤ºåˆ‡æ›¿</button>
    <button id="lineButton">æ”¾ç‰©ç·š/ç›´ç·šåˆ‡æ›¿</button>
    <button id="resetButton">ãƒªã‚»ãƒƒãƒˆ</button>
  </span>
</div>

<script>
let mode = "sim"; 
let rays = [];
let p = 100; 
let showFocus = true;
let sliderX = 0;
let curveMode = "parabola";

function setup() {
  createCanvas(800,600);

  document.getElementById("simButton").addEventListener("click", ()=>{
    mode="sim"; document.getElementById("simControls").style.display="inline-block";
  });
  document.getElementById("explainButton").addEventListener("click", ()=>{
    mode="explain"; document.getElementById("simControls").style.display="none";
  });

  sliderX = parseFloat(document.getElementById("xSlider").value);
  document.getElementById("xSlider").addEventListener("input", ()=>{
    sliderX = parseFloat(document.getElementById("xSlider").value);
    document.getElementById("xValue").innerText = sliderX;
  });

  document.getElementById("dropButton").addEventListener("click", ()=>{
    launchRay(sliderX);
  });

  document.getElementById("superButton").addEventListener("click", ()=>{
    for(let i=-100;i<=100;i+=20){
      launchRay(i);
    }
  });

  document.getElementById("toggleFocus").addEventListener("click", ()=>{ showFocus = !showFocus; });
  document.getElementById("resetButton").addEventListener("click", ()=>{ rays = []; });
  document.getElementById("lineButton").addEventListener("click", ()=>{
    curveMode = (curveMode==="parabola" ? "line" : "parabola");
  });
}

function launchRay(x0){
  let y0;
  y0 = -x0*x0/(4*p) - 300;
  rays.push({ x:x0, y:y0, vx:0, vy:2, r:3, bounce:0, trail:[] });
}

function draw() {
  background(240);
  if(mode=="sim") drawSimulation();
  else drawExplanation();
}

function drawSimulation(){
  translate(width/2, height/2);
  drawAxes();
  if(curveMode==="parabola") drawParabola();
  else drawTwoLines();
  if(curveMode==="parabola") drawFocus();
  updateRays();
  drawTrails();
  drawRays();
  drawLaunchMarker();
}

function drawAxes(){
  stroke(0); line(-width/2,0,width/2,0); line(0,-height/2,0,height/2);
}

function drawParabola(){
  stroke("blue"); noFill(); beginShape();
  for(let x=-width/2; x<=width/2; x+=2){
    let y = -x*x/(4*p);
    vertex(x,y);
  }
  endShape();
}

function drawTwoLines(){
  stroke("blue");
  line(-width/2, -200, 0, 200);  
  line(0, 200, width/2, -200);  
}

function drawFocus(){
  if(showFocus){ fill("red"); noStroke(); ellipse(0,-p,8,8); }
}

function drawLaunchMarker(){
  let markerY = -sliderX*sliderX/(4*p) - 300;
  stroke("green");
  line(sliderX, markerY-10, sliderX, markerY+10);
  noStroke(); fill("green"); ellipse(sliderX, markerY, 6,6);
}

function updateRays(){
  for(let r of rays){
    if(curveMode==="parabola" && r.bounce>=1){
      r.x += r.vx;
      r.y += r.vy;
      r.trail.push({x:r.x,y:r.y});
      if(r.trail.length>1000) r.trail.shift();
      continue;
    }
    if(curveMode==="line" && r.bounce>=3) continue;

    r.x += r.vx; 
    r.y += r.vy;
    r.trail.push({x:r.x,y:r.y});
    if(r.trail.length>1000) r.trail.shift();

    let surfaceY, slope;
    if(curveMode==="parabola"){
      surfaceY = -r.x*r.x/(4*p);
      slope = -r.x/(2*p);
    } else {
      surfaceY = -Math.abs(r.x) + 200; 
      slope = (r.x>=0) ? -1 : 1;
    }

    if(r.y >= surfaceY){
      let nx = -slope, ny = 1;
      let norm = Math.sqrt(nx*nx+ny*ny);
      nx/=norm; ny/=norm;
      let dot = r.vx*nx + r.vy*ny;
      r.vx -= 2*dot*nx;
      r.vy -= 2*dot*ny;
      r.y = surfaceY - 1;
      r.bounce++;
    }
  }
}

function drawTrails(){
  for(let r of rays){
    stroke(150,0,200,100); noFill(); beginShape();
    r.trail.forEach(pt=>vertex(pt.x, pt.y));
    endShape();
  }
}

function drawRays(){
  fill("orange"); noStroke();
  for(let r of rays){ ellipse(r.x,r.y,r.r*2,r.r*2); }
}

function drawExplanation(){
  resetMatrix();
  background(250);
  textSize(18); textAlign(LEFT, TOP);
  fill("green"); text("ğŸŸ¢ æ”¾ç‰©ç·šã¨ç›´ç·šã®æ¯”è¼ƒ", 20, 20);

  textSize(14);
  fill("blue"); text("æ”¾ç‰©ç·šï¼š", 40,70); 
  fill("black"); text("å…‰ã¯ç„¦ç‚¹ï¼ˆèµ¤ï¼‰ã«é›†ã¾ã‚‹ã€‚", 120,70);
  fill("blue"); text("Vå­—å‹ç›´ç·šï¼š", 40,100); 
  fill("black"); text("å…‰ã¯3å›åå°„ã—ã¦æ•£ã‚‰ã°ã‚‹ã€‚", 160,100);

  stroke("blue"); noFill();
  beginShape(); for(let x=-80;x<=80;x+=4){ let y=-x*x/(4*30); vertex(100+x,180+y);} endShape();
  fill("red"); noStroke(); ellipse(100,180-30,6,6);

  stroke("blue");
  line(300-80,180-40,300,180+80);
  line(300,180+80,300+80,180-40);
}
</script>
</body>
</html>`;
    } else if(name==='montecarlo'){
        iframe.srcdoc = `<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•ã§Ï€ã‚’æ±‚ã‚ã‚‹</title>
</head>
<body>
<h1>ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•ã§Ï€ã‚’æ±‚ã‚ã‚ˆã†ï¼ˆé¢ç©1æ–¹å¼ï¼‰</h1>
<p>èµ¤ï¼šå††ã®ä¸­ã€é’ï¼šå††ã®å¤–</p>

<div style="display:flex; gap:20px;">
  <div>
    <canvas id="canvas" width="400" height="400" style="border:1px solid #000;"></canvas>
    <div style="margin-top:10px;">
      <button onclick="addPoints(100)">100ç‚¹è¿½åŠ </button>
      <button onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
      <button onclick="showPrinciple()">åŸç†ã‚’è§£èª¬</button>
    </div>
    <p id="piValue">Ï€ã®è¿‘ä¼¼å€¤: 0</p>
  </div>

  <div>
    <h3>Ï€ã®è¿‘ä¼¼å€¤ã®æ¨ç§»</h3>
    <canvas id="graph" width="400" height="400" style="border:1px solid #000;"></canvas>
  </div>
</div>

<div id="principle" style="margin-top:20px; display:none; text-align:center; max-width:420px; margin:auto; border:1px solid #ccc; padding:10px; background:#f9f9f9;">
  <canvas id="principleCanvas" width="200" height="200" style="border:1px solid #000;"></canvas>
  <p id="principleText" style="text-align:left; margin-top:10px;"></p>
  <p id="principleSummary" style="margin-top:10px; font-weight:bold; color:darkred;"></p>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const size = canvas.width;
const r = 0.5;

let totalPoints = 0;
let insideCircle = 0;
let piHistory = [];

drawSquareAndCircle();
drawGraph();

function drawSquareAndCircle(){
    ctx.clearRect(0,0,size,size);
    ctx.strokeStyle = "black";
    ctx.strokeRect(0,0,size,size);
    ctx.beginPath();
    ctx.arc(size/2, size/2, size*r, 0, Math.PI*2);
    ctx.stroke();
}

function addPoints(n){
    for(let i=0;i<n;i++){
        let x = Math.random();
        let y = Math.random();
        let dx = x - 0.5;
        let dy = y - 0.5;
        totalPoints++;
        if(dx*dx + dy*dy <= r*r){
            insideCircle++;
            ctx.fillStyle = 'red';
        } else {
            ctx.fillStyle = 'blue';
        }
        ctx.fillRect(x*size-2, y*size-2, 4, 4);
    }
    const piApprox = 4*insideCircle/totalPoints;
    piHistory.push({points: totalPoints, value: piApprox});
    document.getElementById('piValue').textContent = "Ï€ã®è¿‘ä¼¼å€¤: " + piApprox.toFixed(6);
    drawGraph();
}

function drawGraph(){
    const graph = document.getElementById('graph');
    const gctx = graph.getContext('2d');
    gctx.clearRect(0,0,graph.width,graph.height);

    gctx.strokeStyle = 'black';
    gctx.beginPath();
    gctx.moveTo(50,graph.height-50);
    gctx.lineTo(graph.width-10,graph.height-50);
    gctx.moveTo(50,10);
    gctx.lineTo(50,graph.height-50);
    gctx.stroke();

    gctx.fillStyle = 'black';
    gctx.font = '12px sans-serif';
    gctx.fillText('ç·ç‚¹æ•°', graph.width/2, graph.height-10);
    gctx.fillText('Ï€è¿‘ä¼¼å€¤', 5, 20);

    if(piHistory.length < 2) return;

    const xMin = 100;
    const xMax = piHistory[piHistory.length-1].points;
    const yMin = 2.5, yMax = 4;
    const xScale = (graph.width-60)/(xMax - xMin);
    const yScale = (graph.height-60)/(yMax-yMin);

    gctx.strokeStyle = 'red';
    gctx.beginPath();
    piHistory.forEach((v,i)=>{
        const x = 50 + (v.points - xMin)*xScale;
        const y = graph.height - 50 - (v.value - yMin)*yScale;
        if(i===0) gctx.moveTo(x,y);
        else gctx.lineTo(x,y);
    });
    gctx.stroke();

    const latest = piHistory[piHistory.length-1];
    const lx = 50 + (latest.points - xMin)*xScale;
    const ly = graph.height - 50 - (latest.value - yMin)*yScale;

    gctx.fillStyle = 'red';
    gctx.beginPath();
    gctx.arc(lx, ly, 4, 0, Math.PI*2);
    gctx.fill();

    gctx.fillStyle = 'black';
    gctx.fillText(latest.value.toFixed(3), lx-15, ly-10);
    gctx.fillText(latest.points, lx-15, graph.height-35);

    gctx.strokeStyle = 'blue';
    gctx.beginPath();
    const piY = graph.height - 50 - (Math.PI - yMin)*yScale;
    gctx.moveTo(50,piY);
    gctx.lineTo(graph.width-10,piY);
    gctx.stroke();
}

function resetAll(){
    totalPoints = 0;
    insideCircle = 0;
    piHistory = [];
    drawSquareAndCircle();
    drawGraph();
    document.getElementById('piValue').textContent = "Ï€ã®è¿‘ä¼¼å€¤: 0";
}

function showPrinciple() {
    const div = document.getElementById('principle');
    div.style.display = 'block';

    const pCanvas = document.getElementById('principleCanvas');
    const pCtx = pCanvas.getContext('2d');
    const pSize = pCanvas.width;
    const pr = 0.5;

    pCtx.clearRect(0,0,pSize,pSize);
    pCtx.strokeStyle = "black";
    pCtx.strokeRect(0,0,pSize,pSize);
    pCtx.beginPath();
    pCtx.arc(pSize/2, pSize/2, pSize*pr, 0, Math.PI*2);
    pCtx.stroke();

    for(let i=0;i<5;i++){
        let x = Math.random();
        let y = Math.random();
        let dx = x - pr;
        let dy = y - pr;
        if(dx*dx + dy*dy <= pr*pr){
            pCtx.fillStyle = 'red';
        } else {
            pCtx.fillStyle = 'blue';
        }
        pCtx.fillRect(x*pSize-2,y*pSize-2,4,4);
    }

    const text = \`
ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•ã§Ï€ã‚’æ±‚ã‚ã‚‹åŸç†ï¼ˆé¢ç©1æ–¹å¼ï¼‰

1ï¸âƒ£ 1è¾º1ã®æ­£æ–¹å½¢ï¼ˆé¢ç©1ï¼‰ã‚’æã
2ï¸âƒ£ æ­£æ–¹å½¢å†…ã«ãƒ©ãƒ³ãƒ€ãƒ ã«ç‚¹ã‚’æ‰“ã¤
3ï¸âƒ£ å††ã®ä¸­ã‹åˆ¤å®šï¼ˆèµ¤ï¼šä¸­ã€é’ï¼šå¤–ï¼‰
4ï¸âƒ£ èµ¤ã„ç‚¹ã®å‰²åˆ Ã—4 ã§Ï€ã‚’è¿‘ä¼¼
\`;
    document.getElementById('principleText').innerText = text;
    document.getElementById('principleSummary').innerText = "ã¾ã¨ã‚ï¼šç‚¹ã‚’å¢—ã‚„ã™ã¨ã€Ï€ã®è¿‘ä¼¼å€¤ã¯ã©ã‚“ã©ã‚“æ­£ç¢ºã«ãªã‚Šã¾ã™ï¼";
}
</script>
</body>
</html>`;
    }
}
</script>

</body>
</html>
